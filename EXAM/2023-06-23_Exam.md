# LSP考试 2023年6月23日

## 考试信息
- 日期：2023年6月23日
- 语言：捷克语
- 包含统计数据图表

---

## 第1题 - RS锁存器仿真 (4分)
**题目：** 给定输入A, B, C在时间t0-t4的值，写出X和Y输出的值
**[English]** Given inputs A, B, C values at times t0-t4, write the values of X and Y outputs

**输入序列：**
```
A = 1 | 1 | 0 | 0 | 0
B = 0 | 1 | 1 | 1 | 0
C = 0 | 0 | 0 | 1 | 1
    t0  t1  t2  t3  t4
```

---

## 第2题 - Shannon展开 (6分)
**题目：** 将X=f(A,B,C,X)分解为：
**[English]** Decompose X=f(A,B,C,X) into:
$$X = (\overline{X} \land f_0(A,B,C)) \lor (X \land f_1(A,B,C))$$

---

## 第3题 - 等价逻辑函数 (4分)
**题目：** 勾选所有具有等价函数的逻辑函数：
**[English]** Check all logic functions that have an equivalent function:

```vhdl
y1 <= B or (not A and B and D) or (A and B and C);
y2 <= (B and D) or (D and not A) or (A and not D);
y3 <= (A or D) and (B or D or not A);
y4 <= (not A xor not D) or (B and D);
```

---

## 第4题 - VHDL函数编写 (6分)
**题目：** 编写VHDL函数，计算AS7类型数组的四舍五入整数平均值。要求最快的硬件计算速度。
**[English]** Write a VHDL function to calculate the rounded integer average of an AS7 type array. Require fastest hardware calculation speed.

```vhdl
type AS7 is array(0 to 6) of integer range -2**15 to 2**15-1;

function meanAS7(x: AS7) return integer is
  variable sum : integer;
begin
  sum := x(0) + x(1) + x(2) + x(3) + x(4) + x(5) + x(6);
  return (sum + 3) / 7;  -- +3实现四舍五入
end function;
```

**优化技巧：**
- 并行加法（树形结构）
- 避免除法（使用乘法和移位近似）
- 7 ≈ 2³ - 1，可用特殊技巧

---

## 第5题 - 多路复用器电路实现 (8分)
**题目：** 仅使用AND、NAND、OR、NOR门和反相器实现给定的多路复用器电路
**[English]** Implement the given multiplexer circuit using only AND, NAND, OR, NOR gates and inverters

**符号：**
```
     x ─── 0 ─┬─ 0 ─┐
     y ─── 1 ─┤     ├─ q
     z ───────┴─ 1 ─┘
     a0
     a1
```

**逻辑方程：**
```
q = (not a1 and not a0 and x) or 
    (not a1 and a0 and y) or 
    (a1 and z)
```

简化为：
```
q = (not a1 and ((not a0 and x) or (a0 and y))) or (a1 and z)
```

---

## 第6题 - 多路复用器VHDL描述 (6分)
**题目：** 用最简单的VHDL描述第5题电路
**[English]** Describe the circuit from question 5 in simplest VHDL

```vhdl
library ieee; use ieee.std_logic_1164.all; use ieee.numeric_std.all;
entity yyy is 
  port(x, y, z, a1, a0: in std_logic; 
       q: out std_logic);
end entity;
architecture dataflow of yyy is
begin
  q <= z when a1='1' else
       y when a0='1' else
       x;
end architecture;
```

---

## 第7题 - 分支预测器 (6分)
**题目：** C程序在数组中查找最小值，假设for循环编译为do-while，计算错误预测次数：
**[English]** C program finds minimum in array, assuming for-loop compiled as do-while, calculate misprediction count:

```c
int data[] = { 0, 1, 2, 3, 4, -5, -6, -7, 8, 9 };
int min = INT_MAX;
for (int i = 0; i < sizeof(data)/sizeof(int); i++)
{ 
  if (data[i] < min) min = data[i];
}
```

**答案：**
- 1位预测器（初始Not-Taken）: misses = ?
- 2位预测器（初始Weakly Taken）: misses = ?

---

## 第8题 - Cache计算 (10分)
**题目：** 32位处理器，cache仅128字节，2路组相联，行长1字，使用LRU替换算法
**[English]** 32-bit processor, cache only 128 bytes, 2-way set associative, line size 1 word, using LRU replacement

访问序列：0x14, 0x94, 0x14, 0x94, 0x114, 0x14

**Cache参数：**
- 32位处理器：字 = 4字节
- 行长1字 = 4字节
- 128字节 / 4字节 = 32行
- 2路组相联：32/2 = 16组
- 地址分解：
  - Offset: 2位（字节偏移）
  - Set Index: 4位（16组）
  - Tag: 剩余位

---

## 第9题 - 附加题：3位Johnson计数器 (10分)
**题目：** 实现3位同步Johnson计数器
**[English]** Implement a 3-bit synchronous Johnson counter
- RESET='1'时Q="000"
- DN=0时正向计数：000,001,011,111,110,100,000...
- DN=1时反向计数

```vhdl
library ieee; use ieee.std_logic_1164.all; use ieee.numeric_std.all;
entity JC3 is 
  port (clk, DN, RESET: in std_logic;
        Q: out std_logic_vector(2 downto 0));
end entity;
architecture rtl of JC3 is
  signal q_int : std_logic_vector(2 downto 0) := "000";
begin
  process(clk)
  begin
    if rising_edge(clk) then
      if RESET = '1' then
        q_int <= "000";
      elsif DN = '0' then
        q_int <= q_int(1 downto 0) & (not q_int(2));
      else
        q_int <= (not q_int(0)) & q_int(2 downto 1);
      end if;
    end if;
  end process;
  Q <= q_int;
end architecture;
```

---

## 知识点总结

### 本次考试重点
1. RS锁存器仿真
2. Shannon展开
3. 等价逻辑函数
4. **VHDL函数编写**（快速平均值）
5. 多路复用器电路实现
6. 多路复用器VHDL描述
7. **分支预测器计算**（重要！）
8. **Cache计算**（2路组相联）
9. Johnson计数器设计
